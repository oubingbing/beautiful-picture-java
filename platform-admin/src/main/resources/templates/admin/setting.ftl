<!DOCTYPE html><html><head>    <meta charset="UTF-8">    <title>设置</title>    <meta name="renderer" content="webkit">    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />    <link rel="stylesheet" href="/static/css/font.css">    <link rel="stylesheet" href="/static/css/xadmin.css">    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"></head><style>    .app-info{        background: #EFEEF0;        padding: 5px;        border-radius: 1px;    }    .qiniu-container{        position: relative;        z-index: 10;    }    .qiniu-edit{        position: absolute;        z-index: 100;        right: 0px;        top: -13px;    }    .qiniu-edit img{        width: 50px;        height: 50px;    }</style><body><div class="x-body layui-anim layui-anim-up" id="app">    <blockquote class="layui-elem-quote">你好，在这里你可以设置自己的七牛云存储，logo和关于我们</blockquote>    <fieldset class="layui-elem-field" style="margin-top: 50px">        <legend style="color: #009688">分享设置</legend>        <div class="layui-field-box qiniu-container">            <form action="" id="qiNiuForm" @submit.prevent="submitShareForm">                <table class="layui-table">                    <tbody>                    <tr>                        <th>分享封面图</th>                        <td class="name">                            <div class="layui-field-box">                                <div><img style="width: 90px;height: 90px;margin-bottom: 10px" v-bind:src="imageUrl+shareUrl"></div>                                <el-upload                                        v-if="logoUrl"                                        :action="upLoadDomain"                                        class="upload-demo"                                        :on-success="uploadShareImage"                                        list-type="picture">                                    <el-button size="small" type="primary">修改</el-button>                                </el-upload>                                <el-upload                                        v-else                                        :action="upLoadDomain"                                        class="upload-demo"                                        :on-success="uploadShareImage"                                        list-type="picture">                                    <el-button size="small" type="primary">上传封面</el-button>                                </el-upload>                            </div>                        </td>                    </tr>                    <tr>                        <th>分享文字</th>                        <td class="name">                            <div class="layui-input-inline" v-if="showShareEdit">                                <textarea rows="5" cols="50"                                          style="height: 100px;"                                          class="layui-input"                                          maxlength="140"                                          lay-verify="required"                                          name="description"                                          v-model="shareForm.shareWord">                                {{shareForm.shareWord}}                                </textarea>                            </div>                            <div style="width: 500px" v-else>                                {{shareForm.shareWord}}                            </div>                        </td></tr>                    </tbody>                </table>                <input type="submit" class="layui-btn layui-btn-warm upload-img" v-if="showShareEdit" value="提交">                <input type="button" class="layui-btn layui-btn-warm upload-img" v-if="showShareEdit" v-on:click="hideEditShare" value="取消">            </form>            <div class="qiniu-edit"><img src="/static/images/edit.png" alt="" v-on:click="editshare"></div>        </div>    </fieldset>    <fieldset class="layui-elem-field" style="margin-top: 50px">        <legend style="color: #009688">七牛账号</legend>        <div class="layui-field-box qiniu-container">            <form action="" id="qiNiuForm" @submit.prevent="submitQiNiuForm">                <table class="layui-table">                    <tbody>                    <tr>                        <th>access_key</th>                        <td class="name">                            <div class="layui-input-inline" v-if="showQiNiuEdit">                                <input type="text"                                       lay-verify="required"                                       class="layui-input"                                       placeholder="app_key"                                       name="accessKey"                                       v-model="qiNiuForm.accessKey"                                       style="width: 250px;float: left">                            </div>                            <span v-else >{{qiNiuForm.accessKey}}</span>                        </td></tr>                    <tr>                        <th>secret_key</th>                        <td class="name">                            <div class="layui-input-inline" v-if="showQiNiuEdit">                                <input type="text"                                       lay-verify="required"                                       class="layui-input"                                       placeholder="secret_key"                                       name="secretKey"                                       v-model="qiNiuForm.secretKey"                                style="width: 250px;float: left">                            </div>                            <span v-else>{{qiNiuForm.secretKey}}</span>                        </td></tr>                    <tr>                        <th>bucket_name</th>                        <td class="name">                            <div class="layui-input-inline" v-if="showQiNiuEdit">                                <input type="text"                                       lay-verify="required"                                       class="layui-input"                                       placeholder="bucket_name"                                       name="bucketName"                                       v-model="qiNiuForm.bucketName"                                style="width: 250px;float: left">                            </div>                            <span v-else>{{qiNiuForm.bucketName}}</span>                        </td></tr>                    <tr>                        <th>domain</th>                        <td class="name">                            <div class="layui-input-inline" v-if="showQiNiuEdit">                                <input type="text"                                       lay-verify="required"                                       class="layui-input"                                       placeholder="domain"                                       name="domain"                                       v-model="qiNiuForm.domain"                                       style="width: 250px;float: left">                            </div>                            <span v-else>{{qiNiuForm.domain}}</span>                        </td></tr>                    <tr>                        <th>region</th>                        <td class="name">                            <div class="layui-input-inline" v-if="showQiNiuEdit">                                <input type="text"                                       lay-verify="required"                                       class="layui-input"                                       placeholder="region"                                       name="region"                                       v-model="qiNiuForm.region"                                style="width: 250px;float: left">                            </div>                            <span v-else>{{qiNiuForm.region}}</span>                        </td></tr>                    </tbody>                </table>                <input type="submit" class="layui-btn layui-btn-warm upload-img" value="提交" v-if="showQiNiuEdit">                <input type="button" class="layui-btn layui-btn-warm upload-img" v-on:click="hideEditQiniu" value="取消" v-if="showQiNiuEdit">            </form>            <div class="qiniu-edit"><img src="/static/images/edit.png" alt="" v-on:click="editQiNiu"></div>        </div>    </fieldset>    <fieldset class="layui-elem-field" style="margin-top: 50px">        <legend style="color: #009688">关于我们</legend>        <div class="layui-field-box qiniu-container">            <form action="" id="qiNiuForm" @submit.prevent="submitAboutForm">                <table class="layui-table">                    <tbody>                    <tr>                        <th>小程序logo</th>                        <td class="name">                            <div class="layui-field-box">                                <div><img style="width: 90px;height: 90px;margin-bottom: 10px" v-bind:src="imageUrl+this.logoUrl"></div>                                <el-upload                                        v-if="logoUrl"                                        :action="upLoadDomain"                                        class="upload-demo"                                        :on-success="uploadSuccessLogo"                                        list-type="picture">                                    <el-button size="small" type="primary">修改</el-button>                                </el-upload>                                <el-upload                                        v-else                                        :action="upLoadDomain"                                        class="upload-demo"                                        :on-success="uploadSuccessLogo"                                        list-type="picture">                                    <el-button size="small" type="primary">上传logo</el-button>                                </el-upload>                            </div>                        </td></tr>                    <tr>                        <th>二维码</th>                        <td class="name">                            <div class="layui-field-box">                                <div><img style="width: 90px;height: 90px;margin-bottom: 10px" v-bind:src="imageUrl+this.qrCodeUrl"></div>                                <el-upload                                        v-if="logoUrl"                                        :action="upLoadDomain"                                        class="upload-demo"                                        :on-success="uploadSuccessQrCode"                                        list-type="picture">                                    <el-button size="small" type="primary">修改</el-button>                                </el-upload>                                <el-upload                                        v-else                                        :action="upLoadDomain"                                        class="upload-demo"                                        :on-success="uploadSuccessQrCode"                                        list-type="picture">                                    <el-button size="small" type="primary">上传二维码</el-button>                                </el-upload>                            </div>                        </td>                    </tr>                    <tr>                    <tr>                        <th>描述</th>                        <td class="name">                            <div class="layui-input-inline" v-if="showAboutEdit">                                <textarea rows="10" cols="100"                                          style="height: 100px;"                                          class="layui-input"                                          maxlength="140"                                          lay-verify="required"                                          name="description"                                          v-model="aboutForm.description">                                {{aboutForm.description}}                                </textarea>                            </div>                            <div style="width: 500px" v-else>                                {{aboutForm.description}}                            </div>                        </td></tr>                    <tr>                        <th>公众号</th>                        <td>                            <div class="layui-input-inline" v-if="showAboutEdit">                                <input type="text"                                       lay-verify="required"                                       class="layui-input"                                       name="publicNumber"                                       v-model="aboutForm.publicNumber"                                       style="width: 250px;float: left">                            </div>                            <span v-else>{{aboutForm.publicNumber}}</span>                        </td></tr>                    <tr>                        <th>微信</th>                        <td>                            <div class="layui-input-inline" v-if="showAboutEdit">                                <input type="text"                                       lay-verify="required"                                       class="layui-input"                                       name="weChatNumber"                                       v-model="aboutForm.weChatNumber"                                       style="width: 250px;float: left">                            </div>                            <span v-else>{{aboutForm.weChatNumber}}</span>                        </td>                    </tr>                    <tr>                        <th>手机</th>                        <td class="name">                            <div class="layui-input-inline" v-if="showAboutEdit">                                <input type="text"                                       lay-verify="required"                                       class="layui-input"                                       placeholder="region"                                       name="phone"                                       v-model="aboutForm.phone"                                       style="width: 250px;float: left">                            </div>                            <span v-else>{{aboutForm.phone}}</span>                        </td>                    </tr>                    <tr>                        <th>邮箱</th>                        <td class="name">                            <div class="layui-input-inline" v-if="showAboutEdit">                                <input type="text"                                       lay-verify="required"                                       class="layui-input"                                       placeholder="region"                                       name="email"                                       v-model="aboutForm.email"                                       style="width: 250px;float: left">                            </div>                            <span v-else>{{aboutForm.email}}</span>                        </td>                    </tr>                    </tbody>                </table>                <input type="submit" class="layui-btn layui-btn-warm upload-img" v-if="showAboutEdit" value="提交">                <input type="button" class="layui-btn layui-btn-warm upload-img" v-if="showAboutEdit" v-on:click="hideEditAbout" value="取消">            </form>            <div class="qiniu-edit"><img src="/static/images/edit.png" alt="" v-on:click="editAbout"></div>        </div>    </fieldset></div></body><script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script type="text/javascript" src="https://unpkg.com/qiniu-js@2.0/dist/qiniu.min.js"></script><script src="https://cdn.bootcss.com/axios/0.17.1/axios.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script><script src="https://unpkg.com/element-ui/lib/index.js"></script><script src="/static/lib/layui/layui.js" charset="utf-8"></script><script type="text/javascript" src="/static/js/xadmin.js"></script><script>    'use strict';    var qiNiuDomain = "${domain}"+'/';    var qiNiuUploadDomain = "${uploadDomain}";    console.log("test111");    var app = new Vue({        el: '#app',        data: {            appInfo:[],            new_user:'-',            visit_user:'-',            all_user:'-',            upLoadDomain:qiNiuUploadDomain,            imageUrl:qiNiuDomain,            logoUrl:'',            qrCodeUrl:'',            shareUrl:'',            showQiNiuEdit:false,            showAboutEdit:false,            showShareEdit:false,            qiNiuForm:{},            aboutForm:{},            shareForm:{}        },        created:function () {            console.log("test");            this.getUploadToken();            this.getAboutInfo();            this.getQiNiuInfo();            this.getShareInfo();        },        methods:{            editAbout:function () {                this.showAboutEdit = true;            },            editshare:function () {                this.showShareEdit = true;            },            hideEditShare:function () {               this.showShareEdit = false;            },            editQiNiu:function () {              this.showQiNiuEdit = true;            },            hideEditQiniu:function () {                this.showQiNiuEdit = false;            },            hideEditAbout:function () {                this.showAboutEdit = false;            },            submitShareForm:function(){                let formData = new FormData();                formData.append('shareImage', this.shareForm.shareImage);                formData.append('shareWord', this.shareForm.shareWord);                let config = {                    headers: {                        'Content-Type': 'multipart/form-data'                    }                }                axios.post('/admin/app/update_share_info',formData,config)                        .then( response=> {                            var res = response.data;                            console.log(res);                            if(res.code == 0){                                this.showShareEdit = false;                                layer.msg('修改成功！');                            }else{                                layer.msg('修改失败！');                            }                }).catch(function (error) {                        console.log(error);                });                return false;            },            submitQiNiuForm:function(){                let formData = new FormData();                formData.append('accessKey', this.qiNiuForm.accessKey);                formData.append('secretKey', this.qiNiuForm.secretKey);                formData.append('bucketName', this.qiNiuForm.bucketName);                formData.append('domain', this.qiNiuForm.domain);                formData.append('region', this.qiNiuForm.region);                let config = {                    headers: {                        'Content-Type': 'multipart/form-data'                    }                }                axios.post('/admin/qiniu/edit',formData,config)                        .then( response=> {                            var res = response.data;                            console.log(res);                            if(res.code == 0){                                this.showQiNiuEdit = false;                                layer.msg('修改成功！');                            }else{                                layer.msg('修改失败！');                            }                        }).catch(function (error) {                    console.log(error);                });                return false;            },            submitAboutForm:function(){                let formData = new FormData();                formData.append('logo', this.aboutForm.logo);                formData.append('description', this.aboutForm.description);                formData.append('publicNumber', this.aboutForm.publicNumber);                formData.append('weChatNumber', this.aboutForm.weChatNumber);                formData.append('phone', this.aboutForm.phone);                formData.append('email', this.aboutForm.email);                formData.append('qrCode', this.aboutForm.qrCode);                let config = {                    headers: {                        'Content-Type': 'multipart/form-data'                    }                }                axios.post('/admin/about/update',formData,config)                        .then( response=> {                            var res = response.data;                            console.log(res);                            if(res.code == 0){                                this.showAboutEdit = false;                                layer.msg('修改成功！');                            }else{                                layer.msg('修改失败！');                            }                        }).catch(function (error) {                    console.log(error);                });                return false;            },            getShareInfo:function () {                axios.get("/admin/app/info").then( response=> {                    var res = response.data;                    console.log("about info:"+JSON.stringify(res))                if(res.code == 0){                    if(res.data != ''){                        this.shareForm = res.data;                        this.shareUrl = res.data.shareImage;                        console.log(this.shareUrl)                        console.log(this.shareForm)                    }                    console.log(_this.shareForm)                }else{                    console.log('error:'+res);                }            }).catch(function (error) {                    console.log(error);                });            },            getAboutInfo:function () {                let _this = this;                axios.get("/admin/about/info").then( response=> {                    let res = response.data;                    if(res.code == 0){                        if(res.data != null){                            _this.aboutForm = res.data;                            _this.logoUrl = _this.aboutForm.logo;                            _this.qrCodeUrl = _this.aboutForm.qrCode;                        }                    }else{                        console.log('error:'+res);                    }                }).catch(function (error) {                    console.log(error);                });            },            getQiNiuInfo:function () {                let _this = this;                axios.get("/admin/qiniu/info").then( response=> {                    var res = response.data;                if(res.code == 0){                    if(res.data != null){                        _this.qiNiuForm = res.data;                    }                }else{                    console.log('error:'+res);                }            }).catch(function (error) {                    console.log(error);                });            },            uploadSuccessQrCode:function (res) {                this.aboutForm.qrCode = res.key;                this.qrCodeUrl = res.key;                this.shareUrl = res.key            },            /**             * 监听上传成功回调             * @param res             **/            uploadShareImage:function (res) {                this.shareUrl = res.key;                this.shareForm.shareImage = res.key;            },            /**             * 监听上传成功回调             * @param res             */            uploadSuccessLogo:function (res) {                this.logoUrl = res.key;                this.aboutForm.logo = res.key;            },            /**             * 获取七牛token             */            getUploadToken:function () {                axios.get("/admin/qiniu/token")                        .then( response=> {                            let resData = response.data;                            if(resData.code == 0){                                this.upLoadDomain = this.upLoadDomain+'?token='+response.data.data.token;                            }else{                                layer.msg('获取token失败');                            }                            console.log(this.upLoadDomain);                        }).catch(function (error) {                    console.log(error);                });            },        }    });</script></html>